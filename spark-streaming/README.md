# Задание

Выберете несколько популярных Telegram канала, с помощью какой-нибудь клиентской библиотеки (например [Telethone](https://github.com/LonamiWebs/Telethon)) научитесь получать свежие сообщения и записывать из в файлы (parquet). Должны быть следующие поля: время, источник (канал), текст сообщения, есть ли медиа. Напишите соответствующий скрипт.

Файл со свежими сообщениями появляется каждую минуту (настраиваемый параметр), в имени содержится временной промежуток накопления сообщений. 

В другом скрипте, с помощью Spark Structured Streaming научитесь находить какие-нибудь аномалии (обсуждение темы, всплеск частоты сообщений и т.п.) в собираемых данных. 

# Запуск

В `.env` конфиг необходимо внести свои данные.

Запускаем `telegram.py` с необходимыми параметрами `--run-time` (время работы скрипта) и `--sleep-time` (период сбора данных). Также необходимо внести нужные для сбора каналы в переменную `channel_usernames` внутри `telegram.py`.

Запускаем `spark_anomaly.py` скрипт, который будет выводить информацию о количестве сообщений внутри 30 секундного окна для каждого отдельного канала.

# Пример выводимой информации:

```
python3 telegram.py
spark-submit spark_anomaly.py
```

```
Batch: 0
-------------------------------------------
+------------------------------------------+-------------------------+------------+
|window                                    |Source                   |MessageCount|
+------------------------------------------+-------------------------+------------+
|{2023-12-20 15:43:00, 2023-12-20 15:43:30}|https://t.me/ru2ch       |1           |
|{2023-12-20 17:00:30, 2023-12-20 17:01:00}|https://t.me/rian_ru     |1           |
|{2023-12-20 15:55:30, 2023-12-20 15:56:00}|https://t.me/readovkanews|1           |
|{2023-12-20 17:59:30, 2023-12-20 18:00:00}|https://t.me/Wylsared    |1           |
|{2023-12-20 19:12:00, 2023-12-20 19:12:30}|https://t.me/rtvimain    |1           |
|{2023-12-20 16:17:00, 2023-12-20 16:17:30}|https://t.me/ru2ch       |1           |
|{2023-12-20 17:47:00, 2023-12-20 17:47:30}|https://t.me/ru2ch       |1           |
|{2023-12-20 17:07:00, 2023-12-20 17:07:30}|https://t.me/exploitex   |1           |
|{2023-12-20 16:12:00, 2023-12-20 16:12:30}|https://t.me/lentachold  |1           |
|{2023-12-20 15:30:00, 2023-12-20 15:30:30}|https://t.me/rian_ru     |1           |
|{2023-12-20 16:11:00, 2023-12-20 16:11:30}|https://t.me/lentachold  |1           |
|{2023-12-20 15:19:00, 2023-12-20 15:19:30}|https://t.me/exploitex   |5           |
|{2023-12-20 18:56:30, 2023-12-20 18:57:00}|https://t.me/readovkanews|1           |
|{2023-12-20 16:43:00, 2023-12-20 16:43:30}|https://t.me/lentachold  |1           |
|{2023-12-20 17:04:00, 2023-12-20 17:04:30}|https://t.me/lentachold  |1           |
|{2023-12-20 15:22:00, 2023-12-20 15:22:30}|https://t.me/readovkanews|1           |
|{2023-12-20 17:57:00, 2023-12-20 17:57:30}|https://t.me/ru2ch       |1           |
|{2023-12-20 15:01:00, 2023-12-20 15:01:30}|https://t.me/readovkanews|1           |
|{2023-12-20 17:41:00, 2023-12-20 17:41:30}|https://t.me/exploitex   |1           |
|{2023-12-20 17:51:30, 2023-12-20 17:52:00}|https://t.me/rtvimain    |1           |
+------------------------------------------+-------------------------+------------+
only showing top 20 rows

-------------------------------------------
Batch: 1
-------------------------------------------
+------------------------------------------+--------------------+------------+
|window                                    |Source              |MessageCount|
+------------------------------------------+--------------------+------------+
|{2023-12-20 18:24:00, 2023-12-20 18:24:30}|https://t.me/ru2ch  |1           |
|{2023-12-20 19:02:00, 2023-12-20 19:02:30}|https://t.me/rian_ru|1           |
|{2023-12-20 17:41:30, 2023-12-20 17:42:00}|https://t.me/rian_ru|1           |
|{2023-12-20 17:16:30, 2023-12-20 17:17:00}|https://t.me/rian_ru|1           |
|{2023-12-20 18:10:00, 2023-12-20 18:10:30}|https://t.me/rian_ru|1           |
|{2023-12-20 18:01:00, 2023-12-20 18:01:30}|https://t.me/rian_ru|1           |
|{2023-12-20 17:19:30, 2023-12-20 17:20:00}|https://t.me/rian_ru|1           |
|{2023-12-20 18:41:00, 2023-12-20 18:41:30}|https://t.me/rian_ru|1           |
|{2023-12-20 17:30:30, 2023-12-20 17:31:00}|https://t.me/rian_ru|1           |
|{2023-12-20 19:04:00, 2023-12-20 19:04:30}|https://t.me/ru2ch  |1           |
+------------------------------------------+--------------------+------------+

-------------------------------------------
Batch: 2
-------------------------------------------
+------------------------------------------+-----------------------+------------+
|window                                    |Source                 |MessageCount|
+------------------------------------------+-----------------------+------------+
|{2023-12-20 19:26:00, 2023-12-20 19:26:30}|https://t.me/lentachold|1           |
+------------------------------------------+-----------------------+------------+

-------------------------------------------
Batch: 3
-------------------------------------------
+------------------------------------------+------------------+------------+
|window                                    |Source            |MessageCount|
+------------------------------------------+------------------+------------+
|{2023-12-20 19:28:00, 2023-12-20 19:28:30}|https://t.me/ru2ch|1           |
+------------------------------------------+------------------+------------+

-------------------------------------------
Batch: 4
-------------------------------------------
+------+------+------------+
|window|Source|MessageCount|
+------+------+------------+
+------+------+------------+

-------------------------------------------
Batch: 5
-------------------------------------------
+------------------------------------------+-------------------------+------------+
|window                                    |Source                   |MessageCount|
+------------------------------------------+-------------------------+------------+
|{2023-12-20 19:39:30, 2023-12-20 19:40:00}|https://t.me/Wylsared    |1           |
|{2023-12-20 19:40:30, 2023-12-20 19:41:00}|https://t.me/readovkanews|1           |
|{2023-12-20 19:45:00, 2023-12-20 19:45:30}|https://t.me/exploitex   |2           |
|{2023-12-20 19:40:30, 2023-12-20 19:41:00}|https://t.me/rtvimain    |1           |
+------------------------------------------+-------------------------+------------+
```